@page "/dashboard"
@using Microsoft.AspNetCore.Authorization
@using personal_blog.core.Handlers
@using personal_blog.core.Models
@using personal_blog.core.Requests.Posts
@using personal_blog.front.Components.Dashboard
@inject IPostHandler Handler;
@attribute [Authorize(Roles = "admin")]

<MudContainer Class="pa-10 align-items-center">
    <MudTabs Centered="true" Rounded="true" ApplyEffectsToContainer="true" Color="Color.Primary">
        <MudTabPanel Text="Posts">
            <PostsManager Posts="Posts"/>
        </MudTabPanel>
        <MudTabPanel Text="Categories">
        
        </MudTabPanel>
        <MudTabPanel Text="Projects">
        
        </MudTabPanel>
    </MudTabs>
</MudContainer>


@code {
    private string? _errorMessage;
    private List<Post> Posts { get; set; } = [];
    
    protected override async Task OnInitializedAsync()
    {
        try
        {
            var request = new GetAllPostsRequest();
            var result = await Handler.GetAllAsync(request);
            if (result.IsSuccess)
            { 
                Posts = result.Data ?? [];
            }
        }
        catch (HttpRequestException ex)
        {
            _errorMessage = $"An error occurred while fetching posts: {ex.Message}";
        }
        catch(Exception ex)
        {
            _errorMessage = $"An unexpected error occurred. Please try again later. {ex.Message}";
        }
    }
}